@startuml
[*] --> 注文作成中 : 初期状態

注文作成中 --> 注文確認待ち : 商品をカートに追加
注文確認待ち --> 支払い待ち : 注文を確定

' キャンセルは「支払い完了まで」可能
注文作成中 --> キャンセル済み : キャンセル(支払い前)
注文確認待ち --> キャンセル済み : キャンセル(支払い前)
支払い待ち --> キャンセル済み : キャンセル(支払い前)

支払い待ち --> 配送準備中 : 支払い完了
配送準備中 --> 配送済み : 配送完了

' 支払い失敗→再通知→支払い待ちに戻る
支払い待ち --> 支払い失敗 : 支払い失敗
支払い失敗 --> 支払い待ち : 再度支払いを通知

@enduml